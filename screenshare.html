<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Global Screen Share</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:black;
  color:white;
  overflow:hidden;
}
video.bg{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-2;
}
.overlay{
  position:fixed;
  inset:0;
  background:rgba(5,5,15,.65);
  z-index:-1;
}
.card{
  max-width:420px;
  margin:auto;
  margin-top:8vh;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(14px);
  padding:20px;
  border-radius:16px;
  border:1px solid rgba(236,72,153,.3);
}
button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#ec4899,#6366f1);
  color:white;
  font-size:14px;
  cursor:pointer;
}
video#screen{
  width:100%;
  margin-top:12px;
  border-radius:12px;
  background:black;
}
.status{
  margin-top:8px;
  font-size:13px;
  opacity:.85;
  text-align:center;
}
input{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:none;
  background:#111;
  color:#0f0;
  font-size:12px;
}
</style>
</head>

<body>

<video class="bg" autoplay muted loop playsinline>
  <source src="https://dlngrofficial.github.io/dlngrchat2/pink-puff-clouds.1920x1080.mp4">
</video>
<div class="overlay"></div>

<div class="card">
  <h3 align="center">üåç Global Screen Share</h3>

  <button onclick="startShare()">Start Sharing (Host)</button>
  <button onclick="stopShare()">Stop Sharing</button>
  <button onclick="reconnect()">Reconnect</button>

  <div class="status" id="status">Waiting for host‚Ä¶</div>

  <input id="roomInput" readonly>

  <video id="screen" autoplay playsinline></video>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCTBijtaD2itFaHPYYAnFm8XdzQjC-r9EU",
  authDomain: "screenshare-5ce9d.firebaseapp.com",
  databaseURL: "https://screenshare-5ce9d-default-rtdb.firebaseio.com",
  projectId: "screenshare-5ce9d"
});

const room = location.hash.substring(1) || Math.random().toString(36).slice(2);
location.hash = room;
document.getElementById("roomInput").value = location.href;

const statusEl = document.getElementById("status");
const video = document.getElementById("screen");
const db = firebase.database().ref("rooms/" + room);

let pc;

function createPC(){
  pc = new RTCPeerConnection();

pc.ontrack = e => {
  video.srcObject = e.streams[0];
  video.play().catch(()=>{});
  statusEl.innerText = "üî¥ Live";
};


  pc.onicecandidate = e => {
    if(e.candidate) db.child("ice").push(e.candidate.toJSON());
  };
}

createPC();

db.child("offer").on("value", async snap=>{
  if(!snap.val() || pc.currentRemoteDescription) return;

  statusEl.innerText = "Connecting‚Ä¶";
  await pc.setRemoteDescription(snap.val());
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  db.child("answer").set(answer);
});

db.child("answer").on("value", snap=>{
  if(snap.val()) pc.setRemoteDescription(snap.val());
});

db.child("ice").on("child_added", snap=>{
  pc.addIceCandidate(new RTCIceCandidate(snap.val()));
});

async function startShare(){
  await db.remove();
  statusEl.innerText = "Sharing screen‚Ä¶";

  const stream = await navigator.mediaDevices.getDisplayMedia({video:true});
  stream.getTracks().forEach(t=>pc.addTrack(t,stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  db.child("offer").set(offer);
}

function stopShare(){
  pc.getSenders().forEach(s=>s.track && s.track.stop());
  statusEl.innerText = "Stopped";
}

function reconnect(){
  pc.close();
  createPC();
  statusEl.innerText = "Reconnected. Waiting for host‚Ä¶";
}
</script>

</body>
</html>
